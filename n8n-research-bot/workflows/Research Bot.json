{
  "name": "Research Bot",
  "nodes": [
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "id": "307fbcad-31c7-4d72-9762-c832708868ed",
      "name": "Split Queries",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [
        14880,
        2528
      ]
    },
    {
      "parameters": {
        "name": "={{ 'research-report-' + $('Workflow Configuration').item.json.searchTopic.substring(0, 30).replace(/[^a-zA-Z0-9ê°€-í£]/g, '_') + '-' + $('Workflow Configuration').item.json.timestamp.substring(0, 10) + '.html' }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {}
      },
      "id": "d060bba6-1c7b-4541-9a5e-37336557a9a0",
      "name": "Google Drive Upload",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        16576,
        2528
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Ce9euIEhg4hQwMCf",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\"queries\": [\"AI ìµœì‹  ë™í–¥ 2024\", \"AI ê¸°ìˆ ì  ë„ì „ê³¼ì œ\", \"AI ì£¼ìš” ì‚¬ë¡€ ì—°êµ¬\", \"AI ì‹œì¥ ì „ë§\", \"AI í•™ìˆ  ìë£Œ\"]}"
      },
      "id": "3085e309-5d8d-4396-94c5-1a7af00cb34d",
      "name": "Query JSON Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        14448,
        2752
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.queries",
        "options": {}
      },
      "id": "3276c198-900e-4529-9689-44b27c0d4110",
      "name": "Split Query Array",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        14656,
        2528
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "search_results",
        "options": {}
      },
      "id": "0d97a90d-7958-4087-9a54-6bc0c698dd2e",
      "name": "Aggregate Search Results",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        15104,
        2528
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "searchTopic",
              "value": "={{ $json.chatInput }}",
              "type": "string"
            },
            {
              "id": "id-2",
              "name": "timestamp",
              "value": "={{ $now.toISO() }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "599f8cda-dc00-4d3d-8de3-bb12afce01b1",
      "name": "Workflow Configuration",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        14080,
        2448
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.searchTopic }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì£¼ì œì— ëŒ€í•´ ë‹¤ê°ë„ë¡œ ë¶„ì„í•  ìˆ˜ ìˆëŠ” ê²€ìƒ‰ ì¿¼ë¦¬ 5ê°œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.\n\nê° ì¿¼ë¦¬ëŠ” ë‹¤ìŒ ê´€ì ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:\n1. ìµœì‹  ë™í–¥ ë° íŠ¸ë Œë“œ\n2. ê¸°ìˆ ì  ë„ì „ê³¼ì œ ë° í•´ê²°ë°©ì•ˆ\n3. ì£¼ìš” ì‚¬ë¡€ ì—°êµ¬ ë° ì„±ê³µ ìŠ¤í† ë¦¬\n4. ì‹œì¥ ì „ë§ ë° ë¯¸ë˜ ì˜ˆì¸¡\n5. í•™ìˆ  ìë£Œ ë° ì—°êµ¬ ë…¼ë¬¸\n\në°˜ë“œì‹œ ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”:\n{\"queries\": [\"query1\", \"query2\", \"query3\", \"query4\", \"query5\"]}"
            }
          ]
        },
        "batching": {}
      },
      "id": "8d6a78a0-a3cf-4613-a028-f401e23ba79e",
      "name": "Query Generator",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.9,
      "position": [
        14304,
        2528
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a report generator.\n\nINPUTS:\n- topic: {{ $json.topic }}\n- search_results: {{ JSON.stringify($json.search_results ?? []) }}\n\nABSOLUTE RULES (MUST FOLLOW):\n1) Output MUST be raw HTML only. No markdown. No code fences. No explanations.\n2) HTML MUST start with <!DOCTYPE html> and be a complete document.\n3) The report topic is ONLY: \"{{ $json.topic }}\".\n   - Every section MUST be about this topic.\n   - If any content is unrelated, DO NOT include it.\n4) Title, subtitle, headings, examples, case studies, outlook MUST match the topic.\n5) Use ONLY the style/layout below (same CSS structure). Do not import external fonts.\n6) Keep it concise but â€œreport-likeâ€: 1,200â€“2,000 Korean characters.\n7) If search_results are irrelevant or empty, write a generic report strictly about the topic WITHOUT inventing precise statistics.\n   - If you include numbers, label them as â€œì¶”ì •/ì˜ˆì‹œâ€ unless clearly supported by search_results.\n8) Language: Korean. (English only in parentheses for section labels)\n9) Emoji in headings MUST NOT be separated into its own line. It must be inside the H2 text.\n\nSTRUCTURE (use exactly these sections, in this order):\n- Header: [topic] íŠ¸ë Œë“œ ë¦¬í¬íŠ¸ + ì˜¤ëŠ˜ ë‚ ì§œ(YYYY-MM-DD)\n- 1) ğŸ“‹ ê°œìš” (Executive Summary)\n- 2) ğŸ“ˆ ìµœì‹  ë™í–¥ (Latest Trends): 5 bullets\n- 3) ğŸ”§ í•µì‹¬ ê³¼ì œ (Key Challenges): 3 items with (ê³¼ì œ/ì˜í–¥/ëŒ€ì‘)\n- 4) ğŸ’¡ ì‚¬ë¡€ (Case Studies): 2 cases (ë¸Œëœë“œ/ì „ëµ/ì™œ ë¨¹í˜”ë‚˜) â€” ë°˜ë“œì‹œ topic ë„ë©”ì¸\n- 5) ğŸ”® ì „ë§ (Outlook): ê¸°íšŒ 3, ë¦¬ìŠ¤í¬ 3\n- Footer: ìƒì„± ì¼ì‹œ, topic ë°˜ë³µ í‘œê¸°\n\nSTYLE (use this exact CSS and layout):\n<!DOCTYPE html>\n<html lang=\"ko\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>{{ $json.topic }} ë¦¬í¬íŠ¸</title>\n  <style>\n    body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; line-height: 1.6; color: #333; margin: 20px auto; max-width: 900px; padding: 0 20px; background-color: #f9f9f9; }\n    h1 { color: #2c3e50; text-align: center; margin-bottom: 40px; font-size: 2.5em; }\n    h2 { color: #34495e; border-bottom: 2px solid #e74c3c; padding-bottom: 10px; margin-top: 50px; font-size: 1.8em; }\n    h3 { color: #e74c3c; margin-top: 30px; font-size: 1.3em; }\n    p { margin-bottom: 15px; text-align: justify; }\n    ul, ol { margin-left: 20px; margin-bottom: 15px; }\n    li { margin-bottom: 8px; }\n    strong { color: #e74c3c; }\n    .summary-box { background-color: #ecf0f1; border-left: 5px solid #e74c3c; padding: 20px; margin-bottom: 30px; }\n    .case-study { background-color: #fcfcfc; border: 1px solid #ddd; padding: 15px; margin-top: 20px; border-radius: 5px; }\n    .case-study h3 { color: #2c3e50; border-bottom: 1px dashed #ddd; padding-bottom: 5px; margin-top: 10px; }\n    .footer { text-align: center; margin-top: 60px; padding-top: 20px; border-top: 1px solid #ccc; color: #777; font-size: 0.9em; }\n  </style>\n</head>\n\nNOW generate the HTML document.",
        "messages": {
          "messageValues": [
            {
              "message": "Output raw HTML ONLY. Do NOT output SheetJS Table Export or escaped HTML like &lt;html&gt;. Do NOT wrap output in code fences (```). Start with <!DOCTYPE html> and end with </html>.\n\nìˆ˜ì§‘ëœ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì´ê³  ì½ê¸° ì‰¬ìš´ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\n\n## ë¦¬í¬íŠ¸ êµ¬ì„± ìš”êµ¬ì‚¬í•­:\n\n### 1. ğŸ“‹ ê°œìš” (Executive Summary)\n- ì£¼ì œì— ëŒ€í•œ ê°„ë‹¨ëª…ë£Œí•œ ì†Œê°œ\n- í•µì‹¬ ë‚´ìš© 3-5ì¤„ ìš”ì•½\n\n### 2. ğŸ“ˆ ìµœì‹  ë™í–¥ (Latest Trends)\n- 2024ë…„ ê¸°ì¤€ ìµœì‹  íŠ¸ë Œë“œ\n- ì£¼ìš” ë³€í™”ì™€ ë°œì „ ì‚¬í•­\n- êµ¬ì²´ì ì¸ ìˆ˜ì¹˜ì™€ ë°ì´í„° í¬í•¨\n\n### 3. ğŸ”§ ê¸°ìˆ ì  ë„ì „ê³¼ì œ (Technical Challenges)\n- í˜„ì¬ ì§ë©´í•œ ì£¼ìš” ê³¼ì œ\n- ê° ê³¼ì œì— ëŒ€í•œ í•´ê²° ë°©ì•ˆ\n- ì‹¤ì œ ì‚¬ë¡€ ê¸°ë°˜ ì„¤ëª…\n\n### 4. ğŸ’¡ ì£¼ìš” ì‚¬ë¡€ ì—°êµ¬ (Case Studies)\n- ì„±ê³µì ì¸ ì ìš© ì‚¬ë¡€ 2-3ê°œ\n- ê° ì‚¬ë¡€ì˜ í•µì‹¬ ì„±ê³µ ìš”ì¸\n- ì‹¤ì§ˆì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥\n\n### 5. ğŸ”® ì‹œì¥ ì „ë§ (Market Outlook)\n- í–¥í›„ 3-5ë…„ ì „ë§\n- ì‹œì¥ ê·œëª¨ ë° ì„±ì¥ë¥  ì˜ˆì¸¡\n- ì£¼ìš” ê¸°íšŒì™€ ìœ„í—˜ ìš”ì†Œ\n\n### 6. ğŸ“š ì°¸ê³  ìë£Œ (References)\n- ì£¼ìš” í•™ìˆ  ìë£Œ ë° ì—°êµ¬\n- ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ ëª…ì‹œ\n\n### 7. âœ… ê²°ë¡  (Conclusion)\n- í•µì‹¬ ì¸ì‚¬ì´íŠ¸ ì •ë¦¬\n- ì‹¤í–‰ ê°€ëŠ¥í•œ ì œì–¸\n\n## ì‘ì„± ê°€ì´ë“œë¼ì¸:\n- ê° ì„¹ì…˜ì€ ëª…í™•í•œ ì œëª©ê³¼ ì´ëª¨ì§€ë¡œ êµ¬ë¶„\n- ë¶ˆë¦¿ í¬ì¸íŠ¸ì™€ ë²ˆí˜¸ ëª©ë¡ì„ ì ê·¹ í™œìš©\n- ë‹¨ë½ì€ 3-4ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ\n- ì „ë¬¸ ìš©ì–´ëŠ” ì‰¬ìš´ ì„¤ëª… ì¶”ê°€\n- ì¤‘ìš”í•œ ë‚´ìš©ì€ **êµµì€ ê¸€ì”¨**ë¡œ ê°•ì¡°\n- ê°€ë…ì„±ì„ ìœ„í•´ ì ì ˆí•œ ê³µë°± ì‚¬ìš©\n\në¦¬í¬íŠ¸ëŠ” HTML í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë˜, ê¹”ë”í•˜ê³  ì „ë¬¸ì ì¸ ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•´ì£¼ì„¸ìš”."
            }
          ]
        },
        "batching": {}
      },
      "id": "19d55208-2395-46fc-821c-60639175ccc7",
      "name": "Report Generator",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.9,
      "position": [
        15552,
        2528
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64Html",
        "options": {
          "fileName": "={{ 'research-report-' + $('Workflow Configuration').item.json.searchTopic.substring(0, 30).replace(/[^a-zA-Z0-9ê°€-í£]/g, '_') + '-' + $('Workflow Configuration').item.json.timestamp.substring(0, 10) + '.html' }}",
          "mimeType": "text/html; charset=utf-8"
        }
      },
      "id": "3c59953b-f87e-4f6e-b52d-96356feb8477",
      "name": "Move Binary Data",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        16352,
        2528
      ]
    },
    {
      "parameters": {
        "jsCode": "// Extract and normalize HTML from Report Generator output\nconst items = $input.all();\nconst firstItem = items[0].json;\n\n// Get the HTML content from text or html field\nlet html = firstItem.text || firstItem.html || '';\n\n// Remove SheetJS Table Export wrapper if present\nconst sheetJsMatch = html.match(/<td id=\"sjs-A2\"[^>]*>([\\s\\S]*?)<\\/td>/);\nif (sheetJsMatch) {\n  html = sheetJsMatch[1];\n}\n\n// Decode HTML entities\nhtml = html\n  .replace(/&lt;/g, '<')\n  .replace(/&gt;/g, '>')\n  .replace(/&amp;/g, '&')\n  .replace(/&quot;/g, '\"')\n  .replace(/&#39;/g, \"'\");\n\n// Convert <br/> tags to newlines\nhtml = html.replace(/<br\\s*\\/?>/gi, '\\n');\n\n// Ensure output starts with <!DOCTYPE html>\nif (!html.trim().startsWith('<!DOCTYPE html>')) {\n  html = '<!DOCTYPE html>\\n' + html;\n}\n\n// Return single item with cleaned HTML\nreturn [{ json: { html: html } }];"
      },
      "id": "72ec39d2-930a-4766-bb26-049daf2053b0",
      "name": "Normalize HTML",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        15904,
        2528
      ]
    },
    {
      "parameters": {
        "jsCode": "// Get HTML from input\nconst html = $input.first().json.html;\n\n// Convert HTML to Base64\nconst base64Html = Buffer.from(html, 'utf8').toString('base64');\n\n// Return single item with base64Html field\nreturn [{ json: { base64Html } }];"
      },
      "id": "98d69a95-1806-49f0-8efb-6549a6d6c328",
      "name": "HTML to Base64",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        16128,
        2528
      ]
    },
    {
      "parameters": {},
      "id": "dce84276-21e1-4297-818e-795487505ca0",
      "name": "Force Single Item",
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        15328,
        2528
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        14304,
        2752
      ],
      "id": "552a1023-0e59-4ab2-962b-572b4c1c2de2",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "qKK8QHFqi361nEE5",
          "name": "n8n free OpenAI API credits"
        }
      }
    },
    {
      "parameters": {
        "public": true,
        "initialMessages": "ì•ˆë…•í•˜ì„¸ìš” ğŸ‘‹ ìš”ì²­í•˜ì‹  ì£¼ì œë¡œ íŠ¸ë Œë“œ ë¦¬í¬íŠ¸ë¥¼ ìë™ ìƒì„±í•´ë“œë¦½ë‹ˆë‹¤.\n\nì›í•˜ì‹œëŠ” ì£¼ì œë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.\nì˜ˆ) ìµœê·¼ K-ë·°í‹° íŠ¸ë Œë“œ / Zì„¸ëŒ€ ì†Œë¹„ íŠ¸ë Œë“œ ë¶„ì„ ë“±\n\në¦¬í¬íŠ¸ëŠ” HTML íŒŒì¼ë¡œ ìƒì„±ë˜ì–´ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— ì €ì¥ë©ë‹ˆë‹¤.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        13776,
        2448
      ],
      "id": "b2efe360-1b40-4ce5-a88f-22cb8ea1035c",
      "name": "When chat message received",
      "webhookId": "39780bb0-c4c4-4015-86b4-475c62d16eff"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4e13e8a6-2d4e-4f2c-a791-5c208d7ed51f",
              "name": "text",
              "value": "=âœ… ë¦¬í¬íŠ¸ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!  \nğŸ“„ Google Driveë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        16768,
        2528
      ],
      "id": "eb9aa960-7813-4006-aa30-2ef843f7c39f",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d406e976-5676-409f-ae2e-ca221e57eb9b",
              "name": "searchTopic",
              "value": "={{ $json.searchTopic }}",
              "type": "string"
            },
            {
              "id": "4ed11b67-e1c9-4d28-9e5f-b1a8ecb097ac",
              "name": "search_results",
              "value": "={{ $json.search_results }}",
              "type": "array"
            },
            {
              "id": "5c27639d-8b48-4b61-9559-ffb473b60b13",
              "name": "topic",
              "value": "={{ $json.searchTopic }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        15216,
        2928
      ],
      "id": "16d0ebf9-d6e1-472c-8745-25c3f62e16da",
      "name": "Edit Fields1"
    }
  ],
  "pinData": {},
  "connections": {
    "Query Generator": {
      "main": [
        [
          {
            "node": "Split Query Array",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Queries": {
      "main": [
        [
          {
            "node": "Aggregate Search Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Workflow Configuration": {
      "main": [
        [
          {
            "node": "Query Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Query JSON Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Query Generator",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Split Query Array": {
      "main": [
        [
          {
            "node": "Split Queries",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Report Generator": {
      "main": [
        [
          {
            "node": "Normalize HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalize HTML": {
      "main": [
        [
          {
            "node": "HTML to Base64",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML to Base64": {
      "main": [
        [
          {
            "node": "Move Binary Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Move Binary Data": {
      "main": [
        [
          {
            "node": "Google Drive Upload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Search Results": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Force Single Item": {
      "main": [
        [
          {
            "node": "Report Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Query Generator",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Report Generator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Workflow Configuration",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive Upload": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Force Single Item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "dd073e53-843c-4e8b-b4f4-aeabda150621",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9999994792a56e8f019d2307ccf92d25d035ba92755c5c0cd0415154282c186b"
  },
  "id": "dlQkltwJmo0vl2sSmBDZ5",
  "tags": []
}